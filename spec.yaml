# Sonar CLI Specification
# This declarative spec defines all CLI commands, options, and structure

cli:
  name: sonarqube-cli
  command: sonar
  description: A CLI application for interacting with SonarQube products

commands:
  # Authentication command
  - name: auth
    description: Manage authentication tokens and credentials
    subcommands:
      - name: login
        description: Save authentication token to keychain
        handler: ./src/commands/auth.ts
        options:
          - name: server
            alias: s
            type: string
            description: SonarQube server URL (default is SonarCloud)

          - name: org
            alias: o
            type: string
            description: SonarCloud organization key (required for SonarCloud)

          - name: with-token
            alias: t
            type: string
            description: Token value (skips browser, non-interactive mode)

        examples:
          - command: sonar auth login
            description: Interactive login for SonarCloud with browser

          - command: sonar auth login -o my-org -t squ_abc123
            description: Non-interactive login with direct token

          - command: sonar auth login -s https://my-sonarqube.io --with-token squ_def456
            description: Non-interactive login for custom server with token

      - name: logout
        description: Remove authentication token from keychain
        handler: ./src/commands/auth.ts
        options:
          - name: server
            alias: s
            type: string
            description: SonarQube server URL

          - name: org
            alias: o
            type: string
            description: SonarCloud organization key (required for SonarCloud)

        examples:
          - command: sonar auth logout -o my-org
            description: Remove token for SonarCloud organization

          - command: sonar auth logout -s https://my-sonarqube.io
            description: Remove token for custom SonarQube server

      - name: purge
        description: Remove all authentication tokens from keychain
        handler: ./src/commands/auth.ts

        examples:
          - command: sonar auth purge
            description: Interactively remove all saved tokens

      - name: status
        description: Show active authentication connection with token verification
        handler: ./src/commands/auth.ts

        examples:
          - command: sonar auth status
            description: Show current server connection and token status

  # Install Sonar tools
  - name: install
    description: Install Sonar tools
    subcommands:
      - name: secrets
        description: Install sonar-secrets binary from https://binaries.sonarsource.com
        handler: ./src/commands/secret.ts
        options:
          - name: force
            type: boolean
            description: Force reinstall even if already installed
            default: false

          - name: status
            type: boolean
            description: Check installation status instead of installing
            default: false

        examples:
          - command: sonar install secrets
            description: Install latest sonar-secrets binary

          - command: sonar install secrets --force
            description: Reinstall sonar-secrets (overwrite existing)

          - command: sonar install secrets --status
            description: Check if sonar-secrets is installed and up to date

  # Setup SonarQube integration for AI coding agents and other tools
  - name: integrate
    description: Setup SonarQube integration for various tools, like AI coding agents, git and others
    handler: ./src/commands/integrate.ts
    options:
      - name: server
        alias: s
        type: string
        description: SonarQube server URL
        default: https://sonarcloud.io

      - name: project
        alias: p
        type: string
        description: Project key

      - name: token
        alias: t
        type: string
        description: Existing authentication token

      - name: org
        alias: o
        type: string
        description: Organization key (for SonarCloud)

      - name: non-interactive
        type: boolean
        description: Non-interactive mode (no prompts)
        default: false

      - name: skip-hooks
        type: boolean
        description: Skip hooks installation
        default: false

      - name: global
        alias: g
        type: boolean
        description: Install hooks and config globally to ~/.claude instead of project directory
        default: false

    examples:
      - command: sonar integrate claude -s https://sonarcloud.io -p my-project
        description: Integrate Claude Code with interactive setup

      - command: sonar integrate claude --skip-hooks
        description: Integrate without installing hooks

      - command: sonar integrate claude -g -s https://sonarcloud.io -p my-project
        description: Integrate globally and install hooks to ~/.claude for all projects

  # List Sonar resources
  - name: list
    description: List Sonar resources
    subcommands:
      - name: issues
        description: Search for issues in SonarQube
        handler: ./src/commands/issues.ts
        options:
          - name: server
            alias: s
            type: string
            description: SonarQube server URL

          - name: token
            alias: t
            type: string
            description: Authentication token

          - name: project
            alias: p
            type: string
            description: Project key
            required: true

          - name: severity
            type: string
            description: Filter by severity
            choices:
              - INFO
              - MINOR
              - MAJOR
              - CRITICAL
              - BLOCKER

          - name: format
            type: string
            description: Output format
            choices:
              - json
              - toon
              - table
              - csv
            default: "json"

          - name: branch
            type: string
            description: Branch name

          - name: pull-request
            type: string
            description: Pull request ID

          - name: all
            type: boolean
            description: Fetch all issues with pagination
            default: "false"

          - name: page-size
            type: number
            description: Page size for pagination
            default: "500"

        examples:
          - command: sonar list issues -p my-project
            description: List issues in a project

          - command: sonar list issues -p my-project --format toon
            description: Output issues in TOON format for AI agents

          - command: sonar list issues -p my-project --severity CRITICAL --all
            description: Fetch all critical issues

      - name: projects
        description: Search for projects in SonarQube
        handler: ./src/commands/projects.ts
        options:
          - name: query
            alias: q
            type: string
            description: Search query to filter projects by name or key

          - name: page
            alias: p
            type: number
            description: Page number
            default: 1

          - name: page-size
            type: number
            description: Page size (1-500)
            default: 500

        examples:
          - command: sonar list projects
            description: List first 500 accessible projects

          - command: sonar list projects -q my-project
            description: Search projects by name or key

          - command: sonar list projects --page 2 --page-size 50
            description: Paginate through projects

  # Analyze code for security issues
  - name: analyze
    description: Analyze code for security issues
    subcommands:
      - name: secrets
        description: Scan a file or stdin for hardcoded secrets
        handler: ./src/commands/analyze.ts
        options:
          - name: file
            type: string
            description: File path to scan for secrets

          - name: stdin
            type: boolean
            description: Read from standard input instead of a file

        examples:
          - command: sonar analyze secrets --file src/config.ts
            description: Scan a file for hardcoded secrets

          - command: cat .env | sonar analyze secrets --stdin
            description: Scan stdin for hardcoded secrets
